Cafe.findNearbyOpenCafes =
SELECT c.* FROM cafes c
WHERE ST_DWithin(
c.location::geography,
ST_SetSRID(ST_MakePoint(:longitude, :latitude), 4326)::geography,
:radius
)
AND c.close_time >= :requiredTime
ORDER BY ST_Distance(
c.location::geography,
ST_SetSRID(ST_MakePoint(:longitude, :latitude), 4326)::geography
)
LIMIT :limit OFFSET :offset
